<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quemador de Tokens - Solana Mainnet (Funciona 2025)</title>
    <script src="https://unpkg.com/@solana/web3.js@1.95.2"></script>
    <script src="https://unpkg.com/@solana/spl-token@0.4.8"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 40px auto; padding: 20px; background: #111; color: #fff; }
        input, button { margin: 10px 0; padding: 12px; width: 100%; border: none; border-radius: 8px; }
        button { background: #ff4500; color: white; font-weight: bold; cursor: pointer; }
        button:hover { background: #ff5500; }
        button:disabled { background: #555; cursor: not-allowed; }
        #status { color: #0f0; font-weight: bold; }
        #error { color: #f66; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üî• Quemador de Tokens Solana (Mainnet)</h1>
    <p>Conecta Phantom (o cualquier wallet) ‚Üí pega la mint ‚Üí quema lo que quieras.<br><strong>¬°Irreversible! Los tokens desaparecen para siempre.</strong></p>
    
    <button id="connectWallet">ü¶ä Conectar Wallet (Phantom, Backpack, etc.)</button>
    <p id="walletAddress"></p>
    
    <label>Mint del token:</label>
    <input type="text" id="mintId" placeholder="Ej: EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v">
    
    <label>Cantidad a quemar (ej. 69.420):</label>
    <input type="number" id="amount" placeholder="420" step="any">
    
    <button id="burnButton" disabled>üî• QUEMAR TOKENS üî•</button>
    
    <p id="status"></p>
    <p id="error"></p>

    <script>
        const connection = new solanaWeb3.Connection('https://api.mainnet-beta.solana.com', 'confirmed');
        const connectBtn = document.getElementById('connectWallet');
        const burnBtn = document.getElementById('burnButton');
        const walletP = document.getElementById('walletAddress');
        const status = document.getElementById('status');
        const error = document.getElementById('error');
        let wallet = null;

        // ====== CONEXI√ìN ACTUALIZADA 2025 (esto es lo que arregla todo) ======
        connectBtn.onclick = async () => {
            if (!window.solana) {
                error.textContent = '‚ùå No tienes wallet instalada. Descarga Phantom: https://phantom.app';
                return;
            }
            try {
                const resp = await window.solana.connect({ onlyIfTrusted: false });
                wallet = resp.publicKey;
                walletP.textContent = `‚úÖ Conectado: ${wallet.toBase58().slice(0,10)}...`;
                connectBtn.textContent = '‚úÖ Wallet Conectada';
                connectBtn.disabled = true;
                burnBtn.disabled = false;
                error.textContent = '';
            } catch (err) {
                error.textContent = err.code === 4001 ? '‚ùå Conexi√≥n cancelada por ti' : 'Error: ' + err.message;
            }
        };

        // ====== QUEMAR TOKENS (corregido y robusto) ======
        burnBtn.onclick = async () => {
            const mintStr = document.getElementById('mintId').value.trim();
            const amountStr = document.getElementById('amount').value;
            if (!mintStr || !amountStr || !wallet) return error.textContent = 'Faltan datos';

            status.textContent = '‚è≥ Procesando...';
            error.textContent = '';

            try {
                const mint = new solanaWeb3.PublicKey(mintStr);
                const amount = parseFloat(amountStr);
                if (isNaN(amount) || amount <= 0) throw new Error('Cantidad inv√°lida');

                // Info del mint (decimales)
                const mintInfo = await splToken.getMint(connection, mint);
                const burnAmount = BigInt(Math.round(amount * 10 ** mintInfo.decimals));

                // ATA (crea si no existe)
                const ata = await splToken.getAssociatedTokenAddress(
                    mint,
                    wallet,
                    false,
                    splToken.TOKEN_PROGRAM_ID,
                    splToken.ASSOCIATED_TOKEN_PROGRAM_ID
                );

                const tx = new solanaWeb3.Transaction();

                // Si la ATA no existe ‚Üí cr√©ala primero
                const ataInfo = await connection.getAccountInfo(ata);
                if (!ataInfo) {
                    tx.add(
                        splToken.createAssociatedTokenAccountInstruction(
                            wallet, ata, wallet, mint
                        )
                    );
                }

                // Instrucci√≥n de quema
                tx.add(
                    splToken.createBurnInstruction(
                        ata,
                        mint,
                        wallet,
                        burnAmount
                    )
                );

                // Blockhash y fee payer
                const { blockhash } = await connection.getLatestBlockhash();
                tx.recentBlockhash = blockhash;
                tx.feePayer = wallet;

                // Firma y env√≠o
                const signed = await window.solana.signTransaction(tx);
                const sig = await connection.sendRawTransaction(signed.serialize());
                await connection.confirmTransaction(sig, 'confirmed');

                status.textContent = `üéâ ¬°Quemados! Tx: ${sig}`;
                window.open(`https://solscan.io/tx/${sig}`, '_blank');
            } catch (err) {
                console.error(err);
                error.textContent = '‚ùå Error: ' + (err.message || err);
            }
        };
    </script>
</body>
</html>