<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quemador Solana 2025 - FUNCIONA EN VERCEL</title>
    <script src="https://unpkg.com/@solana/web3.js@1.95.2/lib/index.iife.min.js"></script>
    <script src="https://unpkg.com/@solana/spl-token@0.4.8/lib/index.iife.min.js"></script>
    <style>
        body { font-family: Arial; max-width: 600px; margin: 40px auto; padding: 20px; background: #000; color: #0f0; text-align: center; }
        input, button { margin: 15px 0; padding: 14px; width: 100%; border-radius: 12px; border: none; font-size: 16px; }
        button { background: #ff4500; color: white; font-weight: bold; }
        button:hover { background: #ff6b00; }
        button:disabled { background: #444; }
        #error { color: #f66; }
        #status { color: #0f9; }
    </style>
</head>
<body>
    <h1>üî• QUEMADOR DE TOKENS SOLANA 2025 üî•</h1>
    <button id="connectWallet">ü¶ä CONECTAR PHANTOM / BACKPACK</button>
    <p id="walletAddress"></p>

    <input type="text" id="mintId" placeholder="Mint del token">
    <input type="number" id="amount" placeholder="Cantidad (ej: 420.69)" step="any">
    <button id="burnButton" disabled>üî• QUEMAR TOKENS</button>

    <p id="status"></p>
    <p id="error"></p>

    <script>
        const connection = new solanaWeb3.Connection('https://api.mainnet-beta.solana.com');
        let provider = null;
        let publicKey = null;

        document.getElementById('connectWallet').onclick = async () => {
            if (!window.solana?.isPhantom) {
                document.getElementById('error').textContent = '‚ùå Instala Phantom';
                return;
            }
            try {
                provider = window.solana;
                await provider.connect(); // ¬°As√≠ de simple en 2025!
                publicKey = provider.publicKey; // ‚Üê Aqu√≠ estaba el error antes

                document.getElementById('walletAddress').textContent = 
                    '‚úÖ Conectado: ' + publicKey.toBase58().slice(0,10) + '...';
                document.getElementById('connectWallet').textContent = '‚úÖ Conectado';
                document.getElementById('connectWallet').disabled = true;
                document.getElementById('burnButton').disabled = false;
                document.getElementById('error').textContent = '';
            } catch (err) {
                document.getElementById('error').textContent = 'Cancelado o error: ' + err.message;
            }
        };

        document.getElementById('burnButton').onclick = async () => {
            const mintStr = document.getElementById('mintId').value.trim();
            const amount = parseFloat(document.getElementById('amount').value);
            if (!mintStr || !amount || !publicKey) return;

            document.getElementById('status').textContent = '‚è≥ Quemando...';

            try {
                const mint = new solanaWeb3.PublicKey(mintStr);
                const mintInfo = await splToken.getMint(connection, mint);
                const burnAmount = BigInt(Math.round(amount * 10**mintInfo.decimals));

                const ata = await splToken.getAssociatedTokenAddress(
                    mint, publicKey, false, splToken.TOKEN_PROGRAM_ID, splToken.ASSOCIATED_TOKEN_PROGRAM_ID
                );

                const tx = new solanaWeb3.Transaction();

                // Crear ATA si no existe
                if (!await connection.getAccountInfo(ata)) {
                    tx.add(splToken.createAssociatedTokenAccountInstruction(
                        publicKey, ata, publicKey, mint
                    ));
                }

                tx.add(splToken.createBurnInstruction(
                    ata, mint, publicKey, burnAmount
                ));

                tx.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;
                tx.feePayer = publicKey;

                const signed = await provider.signTransaction(tx);
                const sig = await connection.sendRawTransaction(signed.serialize());
                await connection.confirmTransaction(sig);

                document.getElementById('status').textContent = 'üéâ ¬°Quemado! ' + sig;
                window.open('https://solscan.io/tx/' + sig);
            } catch (err) {
                document.getElementById('error').textContent = 'Error: ' + err.message;
            }
        };
    </script>
</body>
</html>