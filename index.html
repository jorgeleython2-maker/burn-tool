<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quemador Solana - FUNCIONA NOVIEMBRE 2025</title>
    <script src="https://unpkg.com/@solana/web3.js@1.95.2/lib/index.iife.min.js"></script>
    <script src="https://unpkg.com/@solana/spl-token@0.3.8/lib/index.iife.min.js"></script>
    <style>
        body {font-family: Arial; max-width: 600px; margin: 40px auto; padding: 20px; background:#000; color:#0f9; text-align:center;}
        input, button {margin:15px 0; padding:16px; width:100%; border-radius:12px; border:none; font-size:18px;}
        button {background:#ff4500; color:white; font-weight:bold;}
        button:disabled {background:#555; cursor:not-allowed;}
        #error {color:#f66;}
        #status {color:#0f9;}
    </style>
</head>
<body>
    <h1>ðŸ”¥ QUEMADOR SOLANA 2025 ðŸ”¥</h1>
    <button id="connectWallet">ðŸ¦Š CONECTAR WALLET</button>
    <p id="walletAddress"></p>

    <label>Mint del token:</label>
    <input type="text" id="mintId" placeholder="Ej: DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263">

    <label>Cantidad a quemar:</label>
    <input type="number" id="amount" placeholder="Ej: 1000" step="any">

    <button id="burnButton" disabled>ðŸ”¥ QUEMAR TOKENS</button>

    <p id="status"></p>
    <p id="error"></p>

    <script>
        // RPC que nunca da 403 (Helius gratis y rÃ¡pido)
        const connection = new solanaWeb3.Connection('https://mainnet.helius-rpc.com/?api-key=0f33e8c8-5494-4073-b27e-0e21e0545a71');

        let provider = null;
        let wallet = null;

        // CONECTAR WALLET
        document.getElementById('connectWallet').onclick = async () => {
            if (!window.solana) return alert('Instala Phantom o Backpack');
            try {
                provider = window.solana;
                await provider.connect();
                wallet = provider.publicKey;
                document.getElementById('walletAddress').textContent = 'âœ… Conectado: ' + wallet.toBase58().substr(0,12) + '...';
                document.getElementById('connectWallet').disabled = true;
                document.getElementById('burnButton').disabled = false;
            } catch (e) {
                document.getElementById('error').textContent = 'ConexiÃ³n cancelada';
            }
        };

        // QUEMAR TOKENS (versiÃ³n 100% funcional 2025)
        document.getElementById('burnButton').onclick = async () => {
            const mintStr = document.getElementById('mintId').value.trim();
            const amount = parseFloat(document.getElementById('amount').value);

            if (!mintStr || !amount || amount <= 0 || !wallet) {
                document.getElementById('error').textContent = 'Rellena todo correctamente';
                return;
            }

            document.getElementById('status').textContent = 'â³ Preparando...';
            document.getElementById('error').textContent = '';

            try {
                const mint = new solanaWeb3.PublicKey(mintStr);

                // Obtener decimales directamente con getMint (funciona siempre)
                const mintInfo = await splToken.getMint(connection, mint);
                const burnAmount = BigInt(Math.round(amount * Math.pow(10, mintInfo.decimals)));

                // ATA del usuario
                const ata = await splToken.getAssociatedTokenAddress(
                    mint,
                    wallet
                );

                const tx = new solanaWeb3.Transaction();

                // Crear ATA si no existe
                if (!(await connection.getAccountInfo(ata))) {
                    tx.add(splToken.createAssociatedTokenAccountInstruction(
                        wallet, // payer
                        ata,
                        wallet, // owner
                        mint
                    ));
                }

                // InstrucciÃ³n de quema (la que nunca falla)
                tx.add(splToken.createBurnInstruction(
                    ata,          // source
                    mint,         // mint
                    wallet,       // owner
                    burnAmount    // amount
                ));

                // Blockhash + fee payer
                const { blockhash } = await connection.getLatestBlockhash();
                tx.recentBlockhash = blockhash;
                tx.feePayer = wallet;

                // Firmar y enviar
                const signed = await provider.signTransaction(tx);
                const signature = await connection.sendRawTransaction(signed.serialize());
                await connection.confirmTransaction(signature, 'confirmed');

                document.getElementById('status').textContent = `Â¡QUEMADO! https://solscan.io/tx/${signature}`;
                window.open(`https://solscan.io/tx/${signature}`);

            } catch (err) {
                console.error(err);
                document.getElementById('error').textContent = 'Error: ' + (err.message || err);
            }
        };
    </script>
</body>
</html>