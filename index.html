<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quemador de Tokens - Solana Mainnet (Funciona 2025)</title>
    <script src="https://unpkg.com/@solana/web3.js@1.95.2"></script>
    <script src="https://unpkg.com/@solana/spl-token@0.4.8"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 40px auto; padding: 20px; background: #111; color: #fff; text-align: center; }
        input, button { margin: 15px 0; padding: 14px; width: 100%; border-radius: 12px; border: none; font-size: 16px; }
        button { background: #ff4500; color: white; font-weight: bold; cursor: pointer; }
        button:hover { background: #ff5a1f; }
        button:disabled { background: #444; cursor: not-allowed; }
        h1 { color: #ff4500; }
        #status { color: #0f9; font-weight: bold; }
        #error { color: #f66; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üî• QUEMADOR DE TOKENS SOLANA üî•</h1>
    <p>Conecta tu wallet ‚Üí pega la mint ‚Üí quema lo que quieras.<br>¬°Irreversible y 100% funcional en 2025!</p>

    <button id="connectWallet">ü¶ä Conectar Wallet (Phantom / Backpack / etc.)</button>
    <p id="walletAddress"></p>

    <label>Mint del token:</label>
    <input type="text" id="mintId" placeholder="Ej: EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v">

    <label>Cantidad a quemar (con decimales si tiene):</label>
    <input type="number" id="amount" placeholder="Ej: 420.69" step="any">

    <button id="burnButton" disabled>üî• QUEMAR TOKENS AHORA üî•</button>

    <p id="status"></p>
    <p id="error"></p>

    <script>
        const connection = new solanaWeb3.Connection('https://api.mainnet-beta.solana.com', 'confirmed');

        const connectBtn = document.getElementById('connectWallet');
        const burnBtn = document.getElementById('burnButton');
        const walletP = document.getElementById('walletAddress');
        const status = document.getElementById('status');
        const error = document.getElementById('error');

        let walletPublicKey = null;

        // ====== CONEXI√ìN ACTUALIZADA 2025 (esto es lo que arregla todo) ======
        connectBtn.onclick = async () => {
            if (!window.solana) {
                error.textContent = '‚ùå Instala Phantom o una wallet compatible';
                return;
            }
            try {
                await window.solana.connect({ onlyIfTrusted: false }); // fuerza el popup siempre
                walletPublicKey = new solanaWeb3.PublicKey(window.solana.publicKey.toBytes());
                walletP.textContent = `‚úÖ Conectado: ${walletPublicKey.toBase58().slice(0,10)}...`;
                connectBtn.textContent = '‚úÖ Wallet Conectada';
                connectBtn.disabled = true;
                burnBtn.disabled = false;
                error.textContent = '';
                status.textContent = '¬°Listo para quemar!';
            } catch (err) {
                error.textContent = err.code === 4001 
                    ? '‚ùå Cancelaste la conexi√≥n' 
                    : 'Error: ' + err.message;
            }
        };

        // ====== QUEMAR TOKENS (rodea todo lo necesario) ======
        burnBtn.onclick = async () => {
            const mintStr = document.getElementById('mintId').value.trim();
            const amountStr = document.getElementById('amount').value;

            if (!mintStr || !amountStr) {
                error.textContent = '‚ùå Completa mint y cantidad';
                return;
            }

            status.textContent = '‚è≥ Preparando transacci√≥n...';
            error.textContent = '';

            try {
                const mint = new solanaWeb3.PublicKey(mintStr);
                const amount = parseFloat(amountStr);
                if (isNaN(amount) || amount <= 0) throw new Error('Cantidad inv√°lida');

                // Obtener decimales
                const mintInfo = await splToken.getMint(connection, mint);
                const burnAmount = BigInt(Math.round(amount * (10 ** mintInfo.decimals)));

                // ATA del usuario
                const ata = await splToken.getAssociatedTokenAddress(
                    mint,
                    walletPublicKey,
                    false,
                    splToken.TOKEN_PROGRAM_ID,
                    splToken.ASSOCIATED_TOKEN_PROGRAM_ID
                );

                const tx = new solanaWeb3.Transaction();

                // Crear ATA si no existe
                const accountInfo = await connection.getAccountInfo(ata);
                if (!accountInfo) {
                    tx.add(
                        splToken.createAssociatedTokenAccountInstruction(
                            walletPublicKey, // payer
                            ata,             // ata
                            walletPublicKey, // owner
                            mint             // mint
                        )
                    );
                }

                // Instrucci√≥n de quema
                tx.add(
                    splToken.createBurnInstruction(
                        ata,             // cuenta token
                        mint,            // mint
                        walletPublicKey, // owner
                        burnAmount       // cantidad en unidades m√≠nimas
                    )
                );

                // Blockhash y fee payer
                const { blockhash } = await connection.getLatestBlockhash();
                tx.recentBlockhash = blockhash;
                tx.feePayer = walletPublicKey;

                // Firmar y enviar
                const signed = await window.solana.signTransaction(tx);
                const signature = await connection.sendRawTransaction(signed.serialize());
                await connection.confirmTransaction(signature, 'confirmed');

                status.textContent = `üéâ ¬°QUEMADOS CORRECTAMENTE!`;
                error.textContent = '';
                window.open(`https://solscan.io/tx/${signature}`, '_blank');

            } catch (err) {
                console.error(err);
                error.textContent = '‚ùå Error: ' + (err.message || err);
                status.textContent = '';
            }
        };
    </script>
</body>
</html>